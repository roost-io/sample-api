# ********RoostGPT********

# Test generated by RoostGPT for test Karate_Test using AI Type Open AI and AI Model gpt-4o
# 
# Feature file generated for /org/{orgID}/oidc-custom-claims_patch for http method type PATCH 
# RoostTestHash=7b6cd0784d
# 
# 

# ********RoostGPT********
Feature: OIDC Token Management - Patch Org-Level Claims

  Background:
    * def urlBase = karate.properties['API_HOST']
    * url urlBase
    * header Authorization = 'Basic REPLACE_BASIC_AUTH'
    * header Content-Type = 'application/json'

  Scenario Outline: Patch org-level custom claims with valid input
    Given path 'org', '<orgID>', 'oidc-custom-claims'
    And request
      """
      { 
        audience: <audience>, 
        ttl: '<ttl>' 
      }
      """
    When method PATCH
    Then status 200
    And match response == '#object'
    And match response.org_id == '<orgID>'
    And match response.audience == <audience>
    And match response.audience_updated_at == '#string'
    And match response.project_id == '#uuid'
    And match response.ttl == '<ttl>'
    And match response.ttl_updated_at == '#string'

    Examples:
      | read('org_orgID_oidc-custom-claims_patch.csv') |

  Scenario Outline: Invalid orgID results in 400 error
    Given path 'org', '<orgID>', 'oidc-custom-claims'
    And request
      """
      { 
        audience: <audience>, 
        ttl: '<ttl>' 
      }
      """
    When method PATCH
    Then status 400
    And match response == '#object'
    And match response.error == '#string'

    Examples:
      | orgID          | audience | ttl  |
      | 'invalid-uuid' | ['aud1'] | '1h' |

  Scenario: Forbidden access results in 403 error
    Given path 'org', '123e4567-e89b-12d3-a456-426614174000', 'oidc-custom-claims'
    And request
      """
      { 
        audience: ['aud1'], 
        ttl: '1h' 
      }
      """
    * header Authorization = 'Basic INVALID_AUTH'
    When method PATCH
    Then status 403
    And match response == '#object'
    And match response.error == 'Forbidden'

  Scenario: Server error results in 500 error
    Given path 'org', '123e4567-e89b-12d3-a456-426614174000', 'oidc-custom-claims'
    And request
      """
      { 
        audience: ['aud1'], 
        ttl: '1h' 
      }
      """
    * configure afterScenario = function() { karate.abort(); }
    When method PATCH
    Then status 500
    And match response == '#object'
    And match response.error == 'internal server error'
