# ********RoostGPT********

# Test generated by RoostGPT for test api-testing-karate-circle-ci using AI Type Azure Open AI and AI Model roostgpt-4-32k
# 
# Feature file generated for /context/{context-id}/environment-variable/{env-var-name}_put for http method type PUT 
# RoostTestHash=a071a14843
# 
# 

# ********RoostGPT********
Feature: Add or Update Environment Variable in a Context
  Description: Tests for the /context/{context-id}/environment-variable/{env-var-name} endpoint.

  Background:
    * def urlBase = karate.properties['URL_BASE']
    * url urlBase
    * def authHeader = 'Basic REPLACE_BASIC_AUTH'
    * def validPayload =
      """
      {
        value: "some-secret-value"
      }
      """

  Scenario: Valid Add or Update Environment Variable
    Given path 'context', '123e4567-e89b-12d3-a456-426614174000', 'environment-variable', 'POSTGRES_USER'
    And header Authorization = authHeader
    And header Content-Type = 'application/json'
    And request validPayload
    When method PUT
    Then status 200
    And match response.variable == 'POSTGRES_USER'
    And match response.created_at == '#string'
    And match response.updated_at == '#string'
    And match response.context_id == '123e4567-e89b-12d3-a456-426614174000'
    And match response.created_at == '#regex "^(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z)$"'
    And match response.updated_at == '#regex "^(\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z)$"'

  Scenario Outline: Invalid Path Parameter
    Given path 'context', '<invalid-context-id>', 'environment-variable', 'POSTGRES_USER'
    And header Authorization = authHeader
    And header Content-Type = 'application/json'
    And request validPayload
    When method PUT
    Then status 404
    And match response.message == '#string'

    Examples:
      | invalid-context-id |
      | incorrect-uuid     |
      |               1234 |

  Scenario Outline: Missing Request Body
    Given path 'context', '123e4567-e89b-12d3-a456-426614174000', 'environment-variable', '<env-var-name>'
    And header Authorization = authHeader
    And header Content-Type = 'application/json'
    When method PUT
    Then status 400
    And match response.message == '#string'

    Examples:
      | env-var-name   |
      | POSTGRES_USER  |
      | MYSQL_PASSWORD |

  Scenario Outline: Invalid Request Body Schema
    Given path 'context', '123e4567-e89b-12d3-a456-426614174000', 'environment-variable', '<env-var-name>'
    And header Authorization = authHeader
    And header Content-Type = 'application/json'
    And request
      """
      <invalid-payload>
      """
    When method PUT
    Then status 400
    And match response.message == '#string'

    Examples:
      | env-var-name   | invalid-payload         |
      | POSTGRES_USER  | { "key": "unexpected" } |
      | MYSQL_PASSWORD | { "value": 123 }        |

  Scenario Outline: Authorization Error
    Given path 'context', '123e4567-e89b-12d3-a456-426614174000', 'environment-variable', '<env-var-name>'
    And header Authorization = 'Basic INVALID_AUTH'
    And header Content-Type = 'application/json'
    And request validPayload
    When method PUT
    Then status 401
    And match response.message == '#string'

    Examples:
      | env-var-name   |
      | POSTGRES_USER  |
      | MYSQL_PASSWORD |

  Scenario: Default Error Response
    Given path 'context', '123e4567-e89b-12d3-a456-426614174000', 'environment-variable', 'POSTGRES_USER'
    And header Authorization = authHeader
    And header Content-Type = 'application/json'
    And request
      """
      {
        value: null
      }
      """
    When method PUT
    Then status 500
    And match response.message CONTAINS 'Error'
