# ********RoostGPT********

# Test generated by RoostGPT for test karateCircleCIFile using AI Type Claude AI and AI Model claude-3-7-sonnet-20250219
# 
# Feature file generated for /insights/{project-slug}/workflows/{workflow-name}_get for http method type GET 
# RoostTestHash=6fff7bb122
# 
# 

# ********RoostGPT********
Feature: Get recent runs of a workflow

  Background:
    * def urlBase = karate.properties['URL_BASE']
    * def authHeader = { Authorization: 'Basic ' + karate.properties['BASIC_AUTH'] }

  Scenario: Get recent workflow runs with default parameters
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And headers authHeader
    When method GET
    Then status 200
    And match response == { items: '#array', next_page_token: '##string' }
    And match each response.items contains { 
      id: '#uuid', 
      branch: '#string', 
      duration: '##number', 
      created_at: '#string', 
      stopped_at: '##string', 
      credits_used: '#number', 
      status: '##string', 
      is_approval: '#boolean' 
    }
    And match each response.items[*].status == '##(status == null || status == "success" || status == "failed" || status == "error" || status == "canceled" || status == "unauthorized")'
    And match each response.items[*].duration == '##number? _ >= 0'
    And match each response.items[*].credits_used == '#number? _ >= 0'
    And match each response.items[*].created_at contains 'T'
    And match each response.items[*].stopped_at == '##string? _ == null || _ contains "T"'

  Scenario Outline: Get recent workflow runs with branch filter
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And param branch = '<branchName>'
    And headers authHeader
    When method GET
    Then status 200
    And match response == { items: '#array', next_page_token: '##string' }
    And match each response.items[*].branch == '<branchName>'

    Examples:
      | branchName |
      | main       |
      | develop    |

  Scenario: Get recent workflow runs for all branches
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And param all-branches = true
    And headers authHeader
    When method GET
    Then status 200
    And match response == { items: '#array', next_page_token: '##string' }

  Scenario: Get recent workflow runs with date range
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And param start-date = '2023-01-01T00:00:00Z'
    And param end-date = '2023-01-31T23:59:59Z'
    And headers authHeader
    When method GET
    Then status 200
    And match response == { items: '#array', next_page_token: '##string' }
    And match each response.items[*].created_at == '#? _ >= "2023-01-01T00:00:00Z" && _ < "2023-01-31T23:59:59Z"'

  Scenario: Get recent workflow runs with pagination - first page
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And headers authHeader
    When method GET
    Then status 200
    And match response == { items: '#array', next_page_token: '##string' }
    * def nextPageToken = response.next_page_token

  Scenario: Get recent workflow runs with pagination - next page
    Given def nextPageToken = __arg.nextPageToken
    And url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And param page-token = nextPageToken
    And headers authHeader
    When method GET
    Then status 200
    And match response == { items: '#array', next_page_token: '##string' }

  Scenario: Get recent workflow runs with invalid project slug
    Given url urlBase
    And path 'insights', 'invalid/project/slug', 'workflows', 'build-and-test'
    And headers authHeader
    When method GET
    Then status 400
    And match response.message == '#string'

  Scenario: Get recent workflow runs with invalid workflow name
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'non-existent-workflow'
    And headers authHeader
    When method GET
    Then status 404
    And match response.message == '#string'

  Scenario: Get recent workflow runs with invalid date range
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And param start-date = '2023-01-01T00:00:00Z'
    And param end-date = '2023-04-01T00:00:00Z'
    And headers authHeader
    When method GET
    Then status 400
    And match response.message == '#string'

  Scenario: Get recent workflow runs with end date but no start date
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And param end-date = '2023-01-31T23:59:59Z'
    And headers authHeader
    When method GET
    Then status 400
    And match response.message == '#string'

  Scenario: Get recent workflow runs with both branch and all-branches parameters
    Given url urlBase
    And path 'insights', 'gh/CircleCI-Public/api-preview-docs', 'workflows', 'build-and-test'
    And param branch = 'main'
    And param all-branches = true
    And headers authHeader
    When method GET
    Then status 400
    And match response.message == '#string'
