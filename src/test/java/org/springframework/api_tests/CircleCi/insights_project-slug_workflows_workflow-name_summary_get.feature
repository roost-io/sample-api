# ********RoostGPT********

# Test generated by RoostGPT for test karateCircleCIFile using AI Type Claude AI and AI Model claude-3-7-sonnet-20250219
# 
# Feature file generated for /insights/{project-slug}/workflows/{workflow-name}/summary_get for http method type GET 
# RoostTestHash=2e0178896c
# 
# 

# ********RoostGPT********
Feature: Get metrics and trends for workflows

  Background:
    * def urlBase = karate.properties['URL_BASE']
    * def projectSlug = 'gh/CircleCI-Public/api-preview-docs'
    * def workflowName = 'build-and-test'

  Scenario: Get workflow summary with default branch
    Given url urlBase
    And path 'insights', projectSlug, 'workflows', workflowName, 'summary'
    When method GET
    Then status 200
    And match response ==
      """
      {
        metrics: {
          total_runs: '#number',
          successful_runs: '#number',
          mttr: '##number',
          total_credits_used: '##number',
          failed_runs: '#number',
          success_rate: '#number',
          completed_runs: '##number',
          window_start: '#string',
          duration_metrics: {
            min: '##number',
            mean: '##number',
            median: '##number',
            p95: '##number',
            max: '##number',
            standard_deviation: '##number'
          },
          window_end: '#string',
          throughput: '#number'
        },
        trends: {
          total_runs: '#number',
          failed_runs: '#number',
          success_rate: '#number',
          p95_duration_secs: '#number',
          median_duration_secs: '#number',
          total_credits_used: '#number',
          mttr: '#number',
          throughput: '#number'
        },
        workflow_names: '#array'
      }
      """
    And match response.metrics.total_runs >= 0
    And match response.metrics.successful_runs >= 0
    And match response.metrics.failed_runs >= 0
    And match response.metrics.success_rate >= 0
    And match response.metrics.throughput >= 0
    And match response.metrics.window_start matches /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/
    And match response.metrics.window_end matches /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/
    And match response.metrics.duration_metrics.min == null || response.metrics.duration_metrics.min >= 0
    And match response.metrics.duration_metrics.mean == null || response.metrics.duration_metrics.mean >= 0
    And match response.metrics.duration_metrics.median == null || response.metrics.duration_metrics.median >= 0
    And match response.metrics.duration_metrics.p95 == null || response.metrics.duration_metrics.p95 >= 0
    And match response.metrics.duration_metrics.max == null || response.metrics.duration_metrics.max >= 0
    And match response.trends.total_runs != null
    And match response.trends.failed_runs != null
    And match response.trends.success_rate != null
    And match response.trends.p95_duration_secs != null
    And match response.trends.median_duration_secs != null
    And match response.trends.total_credits_used != null
    And match response.trends.mttr != null
    And match response.trends.throughput != null
    And match each response.workflow_names == '#string'

  Scenario: Get workflow summary for a specific branch
    Given url urlBase
    And path 'insights', projectSlug, 'workflows', workflowName, 'summary'
    And param branch = 'main'
    When method GET
    Then status 200
    And match response.metrics.total_runs >= 0
    And match response.metrics.successful_runs >= 0
    And match response.metrics.failed_runs >= 0
    And match response.metrics.success_rate >= 0
    And match response.metrics.throughput >= 0
    And match response.metrics.window_start matches /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/
    And match response.metrics.window_end matches /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/
    And match response.metrics.mttr == null || response.metrics.mttr >= 0
    And match response.metrics.total_credits_used == null || response.metrics.total_credits_used >= 0
    And match response.metrics.completed_runs == null || response.metrics.completed_runs >= 0

  Scenario: Get workflow summary for all branches
    Given url urlBase
    And path 'insights', projectSlug, 'workflows', workflowName, 'summary'
    And param all-branches = true
    When method GET
    Then status 200
    And match response.metrics.total_runs >= 0
    And match response.metrics.successful_runs >= 0
    And match response.metrics.failed_runs >= 0
    And match response.metrics.success_rate >= 0
    And match response.metrics.throughput >= 0
    And match response.metrics.window_start matches /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/
    And match response.metrics.window_end matches /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?Z$/
    And match response.metrics.mttr == null || response.metrics.mttr >= 0
    And match response.metrics.total_credits_used == null || response.metrics.total_credits_used >= 0
    And match response.metrics.completed_runs == null || response.metrics.completed_runs >= 0

  Scenario: Get workflow summary with invalid project slug
    Given url urlBase
    And path 'insights', 'invalid-project-slug', 'workflows', workflowName, 'summary'
    When method GET
    Then status 400
    And match response.message == '#string'

  Scenario: Get workflow summary with non-existent workflow name
    Given url urlBase
    And path 'insights', projectSlug, 'workflows', 'non-existent-workflow', 'summary'
    When method GET
    Then status 404
    And match response.message == '#string'

  Scenario Outline: Get workflow summary with different branch parameters
    Given url urlBase
    And path 'insights', projectSlug, 'workflows', workflowName, 'summary'
    And param <paramName> = <paramValue>
    When method GET
    Then status 200
    And match response.metrics.total_runs >= 0
    And match response.metrics.successful_runs >= 0
    And match response.metrics.failed_runs >= 0
    And match response.metrics.success_rate >= 0
    And match response.metrics.throughput >= 0

    Examples:
      | read('insights_project-slug_workflows_workflow-name_summary_get.csv') |
