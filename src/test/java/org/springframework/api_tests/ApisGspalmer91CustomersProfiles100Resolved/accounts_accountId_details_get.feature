# ********RoostGPT********

# Test generated by RoostGPT for test api-karate-customer-management-v3 using AI Type Azure Open AI and AI Model roostgpt-4-32k
# 
# Feature file generated for /accounts/{accountId}/details_get for http method type GET 
# RoostTestHash=2e3bce72a2
# 
# 

# ********RoostGPT********
Feature: Customer Profile API - Retrieve restricted customer profile information

  Background:
    * def urlBase = karate.properties['customer_profile_URL_BASE'] || karate.get('urlBase', 'http://localhost:4010')
    * url urlBase
    * configure headers = { Authorization: '#(karate.properties["customer_profile_AUTH_TOKEN"])' }

  Scenario Outline: Valid request to retrieve customer profile information
    Given path '/accounts/<accountId>/details'
    And header uuid = <uuid>
    And header Accept = 'application/json'
    And header client_id = <clientId>
    And header countryCode = <countryCode>
    When method GET
    Then status 200
    And match response == """
    {
      fullName: '#string',
      firstName: '#string',
      lastName: '#string',
      middleName: '#string?',
      localName: '#string?',
      title: '#string?',
      suffix: '#string?',
      maidenName: '#string?',
      companyName: '#string?',
      emails: '#array',
      addressList: '#array',
      phones: '#array'
    }
    """
    And match response.emails[*].emailAddress == '#string'
    And match response.emails[*].preferenceType == '#string'
    And match response.addressList[*].countryCode == '#string'
    And match response.addressList[*].postalCode == '#string'
    And match response.phones[*].phoneType == '#string'
    And match response.phones[*].preferenceType == '#string'

    Examples:
      | accountId | uuid                          | clientId      | countryCode |
      |     12345 | b3d6a77d-5fb4-4f9c-bad6-6cfe1 | client_xyz123 | US          |

  Scenario Outline: Invalid Authorization header
    Given path '/accounts/<accountId>/details'
    And header uuid = <uuid>
    And header Accept = 'application/json'
    And header client_id = <clientId>
    And header countryCode = <countryCode>
    And header Authorization = 'Bearer invalid_token'
    When method GET
    Then status 401
    And match response == """
    {
      error: 'invalid_token',
      error_description: 'Invalid Token',
      type: 'unAuthorized',
      code: '401',
      details: 'Authorization credentials are missing or invalid or Access token is expired'
    }
    """

    Examples:
      | accountId | uuid                          | clientId      | countryCode |
      |     12345 | b3d6a77d-5fb4-4f9c-bad6-6cfe1 | client_xyz123 | US          |

  Scenario Outline: Missing parameters or invalid Client ID
    Given path '/accounts/<accountId>/details'
    And header uuid = <uuid>
    And header Accept = 'application/json'
    And header client_id = <invalidClientId>
    And header countryCode = <countryCode>
    When method GET
    Then status 400
    And match response == """
    {
      error: 'invalid_request',
      error_description: 'Missing or Invalid parameters or Invalid Client Identifier',
      type: 'error',
      code: '400',
      details: 'Missing or invalid parameters or Bad Request'
    }
    """

    Examples:
      | accountId | uuid                          | invalidClientId | countryCode |
      |     12345 | b3d6a77d-5fb4-4f9c-bad6-6cfe1 | bad_client_id   | US          |

  Scenario Outline: Token generated for different Client ID
    Given path '/accounts/<accountId>/details'
    And header uuid = <uuid>
    And header Accept = 'application/json'
    And header client_id = <clientId>
    And header countryCode = <countryCode>
    And header Authorization = 'Bearer wrong_clientId_token'
    When method GET
    Then status 403
    And match response == """
    {
      error: 'accessNotConfigured',
      error_description: 'Insufficient permission to grant access',
      type: 'error',
      code: '403',
      details: 'accessNotConfigured'
    }
    """

    Examples:
      | accountId | uuid                          | clientId      | countryCode |
      |     12345 | b3d6a77d-5fb4-4f9c-bad6-6cfe1 | client_xyz123 | US          |

  Scenario Outline: Resource not found
    Given path '/accounts/<nonExistentAccountId>/details'
    And header uuid = <uuid>
    And header Accept = 'application/json'
    And header client_id = <clientId>
    And header countryCode = <countryCode>
    When method GET
    Then status 404
    And match response == """
    {
      type: 'error',
      code: 'resourceNotFound',
      details: 'Resource not found'
    }
    """

    Examples:
      | nonExistentAccountId | uuid                          | clientId      | countryCode |
      |                99999 | b3d6a77d-5fb4-4f9c-bad6-6cfe1 | client_xyz123 | US          |

  Scenario Outline: Internal server error
    Given path '/accounts/<accountId>/details'
    And header uuid = <uuid>
    And header Accept = 'application/json'
    And header client_id = <clientId>
    And header countryCode = <countryCode>
    When method GET
    Then status 500
    And match response == """
    {
      type: 'fatal',
      code: 'serverUnavailable',
      details: 'The request failed due to an internal error'
    }
    """

    Examples:
      | accountId | uuid                          | clientId      | countryCode |
      |     12345 | b3d6a77d-5fb4-4f9c-bad6-6cfe1 | client_xyz123 | US          |
