# ********RoostGPT********

# Test generated by RoostGPT for test weatherTest using AI Type Claude AI and AI Model claude-3-5-sonnet-20241022
# 
# Feature file generated for /search.json_get for http method type GET 
# RoostTestHash=72ffe69306
# 
# 

# ********RoostGPT********
Feature: Search/Autocomplete API Tests

  Background:
    * def urlBase = karate.properties['API_HOST']
    * def authToken = karate.properties['key']
    * url urlBase
    * configure headers = { 'Accept': 'application/json' }

  Scenario Outline: Search locations with valid parameters
    Given path '/v1/search.json'
    And param key = authToken
    And param q = '<query>'
    When method GET
    Then status 200
    And match response == '#[*]'
    And match each response ==
      """
      {
          id: '#number',
          name: '#string',
          region: '#string', 
          country: '#string',
          lat: '#number',
          lon: '#number',
          url: '#string'
      }
      """
    And match each response.id == '#? _ >= 0'
    And match each response.lat == '#? _ >= -90 && _ <= 90'
    And match each response.lon == '#? _ >= -180 && _ <= 180'

    Examples:
      | read('search.json_get.csv') |

  Scenario Outline: Invalid search parameters - 400 errors
    Given path '/v1/search.json'
    And param key = authToken
    And param q = '<query>'
    When method GET
    Then status 400
    And match response ==
      """
      {
          code: '#number',
          message: '#string'
      }
      """
    And match response.code == '#? _ >= 1000'

    Examples:
      | query |
      |       |
      | @@@@@ |

  Scenario: Missing API key - 401 error
    Given path '/v1/search.json'
    And param q = 'London'
    When method GET
    Then status 401
    And match response ==
      """
      {
          code: '#number', 
          message: '#string'
      }
      """
    And match response.code == '#? _ == 1002 || _ == 2006'
    And match response.message == '#? _ == "API key not provided" || _ == "API key provided is invalid"'

  Scenario: Invalid API key - 403 error
    Given path '/v1/search.json'
    And param key = 'invalid_key'
    And param q = 'London'
    When method GET
    Then status 403
    And match response ==
      """
      {
          code: '#number',
          message: '#string'
      }
      """
    And match response.code == '#? _ >= 2007 && _ <= 2009'
    And match response.message contains any ['API key has exceeded calls per month quota.', 'API key has been disabled.', 'API key does not have access to the resource.']
